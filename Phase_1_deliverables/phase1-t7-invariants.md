# T7: フロー不変条件（Invariant）リスト

> **タスク**: T1〜T6で定義した全フロー・決定表・ゲートウェイから、「常に成り立たなければならない条件」を抽出・一覧化する
> **検証方法**: 各構成要素（フロー、サブプロセス、ゲートウェイ、決定表）に最低1つの不変条件があること
> **自信度**: 確実（T1〜T6の構造から論理的に導出）
> **入力**: `phase1-t1-decision-conditions.md`, `phase1-t2-dmn-decision-tables.md`, `phase1-t3-bpmn-elements.md`, `phase1-t4-mermaid-flowcharts.md`, `phase1-t5-losscutrecovery-bpmn.md`, `phase1-t6-losscut-recovery-mermaid.md`

---

## 不変条件（Invariant）の定義

| 用語 | 定義 |
|------|------|
| **不変条件** | フローの正しさを保証するために「常に成り立たなければならない」条件 |
| **違反** | 不変条件が満たされない状態。フローの正しさが保証されなくなる |
| **検証方法** | その不変条件が成り立っているか確認する手段 |

**不変条件の分類:**

| 分類 | 説明 | 例 |
|------|------|-----|
| **順序不変条件** | 要素間の実行順序に関する制約 | 「L0チェックはL1チェックに先行する」 |
| **存在不変条件** | 特定の要素・ステップが必ず存在する制約 | 「Bright Linesチェックは省略できない」 |
| **状態不変条件** | フロー内の状態に関する制約 | 「損切り4条件はOR条件で評価される」 |
| **階層不変条件** | レベル間の優先関係に関する制約 | 「上位レベルの判断が下位を常に制約する」 |
| **データ不変条件** | データオブジェクトの整合性に関する制約 | 「CLAUDE.mdは復帰フロー完了時に必ず更新される」 |

---

## 1. 階層構造の不変条件（T1由来）

> **出典**: `phase1-t1-decision-conditions.md` §1〜§3

### INV-H: 階層不変条件群

| ID | 不変条件 | 分類 | 違反時の影響 | 検証方法 |
|----|---------|------|------------|---------|
| **INV-H1** | L0〜L4の評価順序は常にL0→L1→L2→L3→L4であり、逆転しない | 順序 | 下位レベルの判断が上位を侵害する | DT-1のルール番号順序を確認 |
| **INV-H2** | 上位レベルでNoとなった場合、下位レベルの評価は行われない | 順序 | 不合格な条件が無視されて実行に進む | SP-1フローのGW分岐を確認 |
| **INV-H3** | L4（AIファースト）は常にL0〜L3のすべてを通過した後にのみ適用される | 順序 | 守りなき攻め（品質崩壊、依存強化） | メインフローでSP-2がSP-1通過後にのみ到達可能か確認 |
| **INV-H4** | 競合発生時、上位レベルの判断が常に優先される（L0 > L1 > L2 > L3 > L4） | 階層 | 判断の一貫性が失われる | DT-10の優先度列を確認 |
| **INV-H5** | Bright Lines（BL1-BL4）は全レベルに先行し、いかなる判断フロー上でも違反は許されない | 階層 | 人間の制御権喪失、検証なし本番適用 | DT-0がDT-1に先行していることを確認 |

---

## 2. メインフローの不変条件（T3 §1 / T4 §1 由来）

> **出典**: `phase1-t3-bpmn-elements.md` §1, `phase1-t4-mermaid-flowcharts.md` §1

### INV-MF: メインフロー不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-MF1** | すべてのタスクはBright Linesチェック（GW-1）を通過した後にのみ実行される | 順序 | GW-1 → SP-1 | GW-1からSP-1への唯一の経路が「違反なし」であることを確認 |
| **INV-MF2** | Bright Lines違反が検出された場合、是正（T-1）が完了するまでフローは進行しない | 状態 | GW-1, T-1 | T-1→GW-1の再チェックループが存在することを確認 |
| **INV-MF3** | L0-L3チェック（SP-1）が不合格の場合、AIファーストチェック（SP-2）には進めない | 順序 | GW-2 → T-2 → SP-1 | GW-2の「不合格」パスがT-2→SP-1へのループのみであることを確認 |
| **INV-MF4** | AI適用パス（T-4→T-5）を通る場合、人間によるレビュー（T-5）は省略できない | 存在 | T-4, T-5 | T-4からSP-3への直接経路が存在しないことを確認 |
| **INV-MF5** | 人間主導パス（T-3）もAI適用パス（T-4→T-5）も、最終的にSP-3（検証フィードバックループ）を通過する | 存在 | T-3→SP-3, T-5→SP-3 | 両パスがSP-3に合流することを確認 |
| **INV-MF6** | メインフローの終了は「タスク完了（EE-1）」または「損切り→復帰フローへ（EE-2）」の2つのみである | 状態 | EE-1, EE-2 | 終了イベントが2つのみであることを確認 |

---

## 3. SP-1（L0-L3チェック）の不変条件（T3 §2 / T4 §2 由来）

> **出典**: `phase1-t3-bpmn-elements.md` §2, `phase1-t2-dmn-decision-tables.md` DT-1〜DT-5

### INV-SP1: L0-L3チェック不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-SP1-1** | L0（持続可能性）チェックは常に最初に実行される | 順序 | SP1-SE → SP1-T1 | SP1-SEからの最初の遷移先がSP1-T1であることを確認 |
| **INV-SP1-2** | 各レベルのチェックは直前のレベルを通過した後にのみ実行される（L0→L1→L2→L3の逐次実行） | 順序 | SP1-GW1〜GW4 | 各GWのYesパスが次レベルのタスクに接続していることを確認 |
| **INV-SP1-3** | いずれかのレベルでNoとなった場合、SP1-EE-NG（不合格）に遷移し、他レベルの評価はスキップされる | 状態 | SP1-GW1〜GW4 → SP1-EE-NG | 各GWのNoパスがすべてSP1-EE-NGに直結していることを確認 |
| **INV-SP1-4** | SP-1の結果は「全通過（SP1-EE-OK）」または「不合格（SP1-EE-NG）」の2つのみである | 状態 | SP1-EE-OK, SP1-EE-NG | 終了イベントが2つのみであることを確認 |
| **INV-SP1-5** | 各レベルの詳細判断（DT-2〜DT-5）において、「要対応」が1つでもあればそのレベルは不合格となる | 状態 | DT-2〜DT-5の集約ルール | 各DTのヒットポリシーC（収集）と集約ルールを確認 |

---

## 4. SP-2（AIファーストチェック＋分業判断）の不変条件（T3 §3 / T4 §3 由来）

> **出典**: `phase1-t3-bpmn-elements.md` §3, `phase1-t2-dmn-decision-tables.md` DT-6, DT-7

### INV-SP2: AIファーストチェック不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-SP2-1** | タスク特性の分析（SP2-T1）は分業判断の前に必ず実行される | 順序 | SP2-T1 → SP2-GW1 | SP2-T1が省略不可であることを確認 |
| **INV-SP2-2** | AI主導で実行する場合、プロンプト技法の選択（SP2-T3 / DT-7）は省略できない | 存在 | SP2-T3 | SP2-GW2の「AI主導」パスが必ずSP2-T3を経由することを確認 |
| **INV-SP2-3** | 分業結果は「AI主導（SP2-EE-AI）」または「人間主導（SP2-EE-HM）」のいずれかであり、曖昧な状態で終了しない | 状態 | SP2-EE-AI, SP2-EE-HM | 終了イベントが2つのみであることを確認 |
| **INV-SP2-4** | DT-6の各ルールは排他的条件である（ヒットポリシーU: 一意） | 状態 | DT-6 | 同一タスク特性に対して複数ルールが合致しないことを確認 |

---

## 5. SP-3（検証フィードバックループ）の不変条件（T3 §4 / T4 §4 由来）

> **出典**: `phase1-t3-bpmn-elements.md` §4, `phase1-t2-dmn-decision-tables.md` DT-8, DT-9

### INV-SP3: 検証フィードバックループ不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-SP3-1** | 検証の実行順序はtypecheck→lint→testであり、変更できない | 順序 | SP3-T1→SP3-T2→SP3-T3 | 各タスク間の接続順序を確認 |
| **INV-SP3-2** | 前段の検証が成功しない限り、次段の検証には進めない | 順序 | SP3-GW1〜GW3 | 各GWの「成功」パスのみが次タスクに接続していることを確認 |
| **INV-SP3-3** | 協働原則チェック（SP3-T5 / DT-8）とAI行動原則チェック（SP3-T6 / DT-9）は検証プロセスと並行して常に監視される | 存在 | SP3-T5, SP3-T6 | SP3-SEから並行して起動されることを確認 |
| **INV-SP3-4** | いずれかの検証が失敗した場合、損切り判断（LC）が起動される | 状態 | SP3-GW1〜GW3 → LC-SE | 各GWの「失敗」パスがLC-SEに接続していることを確認 |
| **INV-SP3-5** | SP-3の正常終了は全3段階の検証（typecheck, lint, test）がすべて成功した場合のみである | 状態 | SP3-EE-OK | SP3-EE-OKへの唯一の経路がSP3-GW3の「成功」であることを確認 |

---

## 6. 損切り判断サブプロセス（LC）の不変条件（T5 §1 / T6 §1 由来）

> **出典**: `phase1-t5-losscutrecovery-bpmn.md` §1, `phase1-t6-losscut-recovery-mermaid.md` §1

### INV-LC: 損切り判断不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-LC1** | エラー状態の記録（LC-T1）は損切り判定の前に必ず実行される | 順序 | LC-SE → LC-T1 → LC-GW1 | LC-T1が省略不可であることを確認 |
| **INV-LC2** | 損切り4条件（3回/30分/複雑化/再発）はOR条件で評価される（いずれか1つでも該当すれば損切り確定） | 状態 | LC-GW1〜GW4 → LC-EE-CUT | 各GWのYesパスがすべてLC-EE-CUTに直結していることを確認 |
| **INV-LC3** | 損切り4条件のすべてに該当しない場合のみ、修正継続（LC-EE-CONT）となる | 状態 | LC-GW4 → LC-T2 → LC-EE-CONT | LC-EE-CONTへの唯一の経路がLC-GW4の「No」→LC-T2であることを確認 |
| **INV-LC4** | 4条件の評価順序は3回→30分→複雑化→再発の順であり、いずれかでYesとなった時点で残りの条件は評価されない（短絡評価） | 順序 | LC-GW1→GW2→GW3→GW4 | GW間の逐次接続と各YesパスのLC-EE-CUT直結を確認 |
| **INV-LC5** | 30分経過（SP3-IE1）または同一エラー3回目（SP3-IE2）の中間イベントは、損切り判断を強制起動する | 状態 | SP3-IE1, SP3-IE2 → LC-SE | 中間イベントからLC-SEへの接続を確認 |

---

## 7. 復帰フロー（RF）の不変条件（T5 §2 / T6 §2 由来）

> **出典**: `phase1-t5-losscutrecovery-bpmn.md` §2, `phase1-t6-losscut-recovery-mermaid.md` §2

### INV-RF: 復帰フロー不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-RF1** | 問題の分析（RF-T1→T2→T3）は復帰フローの最初のステップとして必ず実行される（5-10分） | 順序 | RF-SE → RF-T1 → RF-T2 → RF-T3 | RF-SEからの最初の遷移がRF-T1であり、T1→T2→T3が逐次接続されていることを確認 |
| **INV-RF2** | CLAUDE.mdへの失敗パターン記録（RF-T9）は**必須ステップ**であり、いかなるアプローチ（A/B/C/D）を選択しても省略できない | 存在 | RF-T9 | すべてのアプローチパス（RF-T4/T5, RF-T6, RF-T7, RF-T8）がRF-T9に合流することを確認 |
| **INV-RF3** | 次回の回避策の明記（RF-T10）はRF-T9の後に必ず実行される | 順序 | RF-T9 → RF-T10 | RF-T9からRF-T10への直接接続を確認 |
| **INV-RF4** | 復帰フローは常にメインフローSE-1に戻る（RF-EE → SE-1） | 状態 | RF-EE | RF-EEからSE-1への遷移が唯一の復帰先であることを確認 |
| **INV-RF5** | アプローチ選択（RF-GW2）は問題の分析（Step 1）完了後にのみ実行される | 順序 | RF-T3 → RF-GW1/GW2 | RF-GW2がRF-T3の後にのみ到達可能であることを確認 |
| **INV-RF6** | アプローチは4パターン（A: 直接解決、B: 再分解、C: リセット、D: エスカレーション）のいずれか1つが選択される | 状態 | RF-GW2 | RF-GW2の出力パスが4つであり、排他的であることを確認 |

---

## 8. エスカレーション判断サブプロセス（ES）の不変条件（T5 §3 / T6 §3 由来）

> **出典**: `phase1-t5-losscutrecovery-bpmn.md` §3, `phase1-t6-losscut-recovery-mermaid.md` §3

### INV-ES: エスカレーション判断不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-ES1** | 「即座にエスカレーション必要」の判定（ES-GW1）は「30分以内」の判定（ES-GW2）に先行する | 順序 | ES-SE → ES-GW1 → ES-GW2 | ES-GW1が最初の分岐であることを確認 |
| **INV-ES2** | セキュリティ問題・本番影響・データ損失リスクのいずれかに該当する場合、即座にエスカレーションが実施される（遅延不可） | 状態 | ES-GW1 → ES-T1 | ES-GW1のYesパスがES-T1（即座に実施）に直結していることを確認 |
| **INV-ES3** | エスカレーション判断の結果は「エスカレーション実施（ES-EE-ESC）」または「自力で対応（ES-EE-SELF）」の2つのみである | 状態 | ES-EE-ESC, ES-EE-SELF | 終了イベントが2つのみであることを確認 |

---

## 9. タスク分解サブプロセス（TD）の不変条件（T3 §6 / T4 §6 由来）

> **出典**: `phase1-t3-bpmn-elements.md` §6, `phase1-t4-mermaid-flowcharts.md` §6

### INV-TD: タスク分解不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-TD1** | タスク分解は「1文1検証を満たしていない」場合にのみ5ステップが実行される | 状態 | TD-GW1 | TD-GW1の「満たしている」パスがTD-T5に直行することを確認 |
| **INV-TD2** | 分解の5ステップ（成果物特定→依存関係→実装単位→1文1検証調整→Type判定）の実行順序は固定である | 順序 | TD-T1→T2→T3→T4→T5 | 逐次接続を確認 |
| **INV-TD3** | Type判定（TD-T5）は分解の最終ステップとして必ず実行される（既に1文1検証を満たしている場合でも） | 存在 | TD-T5 | TD-GW1の両パスがTD-T5を経由することを確認 |
| **INV-TD4** | 分解完了後は必ずメインフローに戻る（TD-EE） | 状態 | TD-EE | TD-EEが唯一の終了イベントであることを確認 |

---

## 10. 決定表（DT）の不変条件（T2由来）

> **出典**: `phase1-t2-dmn-decision-tables.md` DT-0〜DT-10

### INV-DT: 決定表不変条件群

| ID | 不変条件 | 分類 | 対応DT | 検証方法 |
|----|---------|------|-------|---------|
| **INV-DT1** | DT-0（Bright Lines）は他のすべての決定表に先行して評価される | 順序 | DT-0 | 決定表間の関係図でDT-0が最上位であることを確認 |
| **INV-DT2** | DT-0のヒットポリシーF（最初一致）により、BL1-BL4のいずれか1つでも該当すれば即座に停止となる | 状態 | DT-0 | ヒットポリシーFの定義とルール構造を確認 |
| **INV-DT3** | DT-1（メインフロー）のルール評価順序は常にL0→L1→L2→L3→L4であり、ヒットポリシーF（最初一致）により最初のNoで分岐する | 順序 | DT-1 | ルール番号順序とヒットポリシーを確認 |
| **INV-DT4** | DT-2〜DT-5（各レベル詳細）のヒットポリシーC（収集）により、全ルールが評価され、1つでも「要対応」があれば不合格となる | 状態 | DT-2〜DT-5 | 各DTのヒットポリシーと集約ルールを確認 |
| **INV-DT5** | DT-6（分業判断）のヒットポリシーU（一意）により、各タスク特性に対して常に1つのルールのみが合致する | 状態 | DT-6 | ルール間の条件が排他的であることを確認 |
| **INV-DT6** | DT-7（プロンプト技法選択）はDT-6でAI主導と判断された場合にのみ参照される | 順序 | DT-6 → DT-7 | DT-6の出力「AI主導」からDT-7への遷移を確認 |
| **INV-DT7** | DT-8（協働原則）とDT-9（AI行動原則）はタスク実行中に常に適用される（特定の条件下でのみ発火するものではない） | 存在 | DT-8, DT-9 | ヒットポリシーC（収集）で全ルール常時評価であることを確認 |
| **INV-DT8** | DT-10（競合解決）において、上位レベルの判断が常に優先される（Priority順: L0 > L1 > L2 > L3 > L4） | 階層 | DT-10 | ヒットポリシーP（優先度）と優先度列を確認 |

---

## 11. データオブジェクトの不変条件（T3 §7 / T5 §4 由来）

> **出典**: `phase1-t3-bpmn-elements.md` §7, `phase1-t5-losscutrecovery-bpmn.md` §4

### INV-DO: データオブジェクト不変条件群

| ID | 不変条件 | 分類 | 対応データ | 検証方法 |
|----|---------|------|----------|---------|
| **INV-DO1** | CLAUDE.md（D-1）は復帰フローのRF-T9で必ず更新される（省略不可） | データ | D-1 | RF-T9 → D-1の接続を確認（INV-RF2と連動） |
| **INV-DO2** | タスク一覧（D-2）はタスク分解（TD-T5）の出力としてのみ生成される | データ | D-2 | D-2の生成元がTD-T5のみであることを確認 |
| **INV-DO3** | AI出力（D-3）は人間レビュー（T-5）の入力として必ず参照される（レビューなしでの受領は不可） | データ | D-3 | T-4 → D-3 → T-5の接続を確認（INV-MF4と連動） |
| **INV-DO4** | 検証結果（D-4）はSP3-T1〜T3で生成され、SP3-GW1〜GW3の判定入力として使用される | データ | D-4 | 生成元と参照先の対応を確認 |
| **INV-DO5** | エラー状態記録（D-6）は損切り判断（LC-T1）で生成され、4条件の判定（LC-GW1〜GW4）の入力として使用される | データ | D-6 | LC-T1 → D-6 → LC-GW1の接続を確認 |
| **INV-DO6** | 失敗パターン記録（D-5）はCLAUDE.md（D-1）に追記される形で統合される | データ | D-5 → D-1 | RF-T10 → D-5 → D-1の接続を確認 |

---

## 12. フロー間接続の不変条件（T3 §8 / T4 §8 / T5 §5 由来）

> **出典**: `phase1-t4-mermaid-flowcharts.md` §8, `phase1-t5-losscutrecovery-bpmn.md` §5

### INV-CF: フロー間接続不変条件群

| ID | 不変条件 | 分類 | 対応要素 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-CF1** | メインフロー→SP-1→SP-2→SP-3の呼び出し順序は固定であり、入れ替え不可 | 順序 | Main → SP-1 → SP-2 → SP-3 | メインフローのフロー接続関係を確認 |
| **INV-CF2** | SP-3の検証失敗はLC（損切り判断）にのみ遷移し、他のサブプロセスには遷移しない | 状態 | SP3-GW1〜GW3 → LC-SE | 失敗パスの遷移先を確認 |
| **INV-CF3** | LC（損切り確定）からRF（復帰フロー）への遷移は一方向であり、RFからLCへの逆遷移はない | 順序 | LC-EE-CUT → RF-SE | LC→RF方向のみの接続を確認 |
| **INV-CF4** | RF（復帰フロー）完了後はメインフローのSE-1に戻る（他のサブプロセスに直接遷移しない） | 状態 | RF-EE → SE-1 | RF-EEの遷移先がSE-1のみであることを確認 |
| **INV-CF5** | TD（タスク分解）はT-2からのみ呼び出され、他の要素からの直接呼び出しはない | 状態 | T-2 → TD-SE | TD-SEへの遷移元がT-2のみであることを確認 |

---

## 13. Bright Lines固有の不変条件（T1 §3 / T2 DT-0由来）

> **出典**: `phase1-t1-decision-conditions.md` §3, `phase1-t2-dmn-decision-tables.md` DT-0

### INV-BL: Bright Lines不変条件群

| ID | 不変条件 | 分類 | 対応BL | 検証方法 |
|----|---------|------|-------|---------|
| **INV-BL1** | 人間の最終判断権は常に維持される（AIの判断を最終判断理由にしない） | 階層 | BL1 | フロー全体で人間の判断ステップが省略されていないことを確認 |
| **INV-BL2** | 本番環境への適用前に検証ステップが必ず存在する | 存在 | BL2 | SP-3（検証フィードバックループ）が省略不可であることを確認 |
| **INV-BL3** | コード採用前に人間による理解確認ステップが存在する | 存在 | BL3 | T-5（人間レビュー）が省略不可であることを確認（INV-MF4と連動） |
| **INV-BL4** | AIの出力に対する独立した検証が常に実施される | 存在 | BL4 | SP-3のtypecheck/lint/testがAI出力に対して常に実行されることを確認 |

---

## 14. 協働原則・AI行動原則の不変条件（T1 §4 / T2 DT-8, DT-9由来）

> **出典**: `phase1-t1-decision-conditions.md` §4, `phase1-t2-dmn-decision-tables.md` DT-8, DT-9

### INV-CA: 協働・AI行動原則不変条件群

| ID | 不変条件 | 分類 | 対応原則 | 検証方法 |
|----|---------|------|---------|---------|
| **INV-CA1** | DT-8（協働原則C1-C4）のいずれかが「要対応」の場合、是正アクションが実施されるまでタスク実行は継続されない | 状態 | C1-C4 | DT-8のルール構造と是正アクションを確認 |
| **INV-CA2** | DT-9（AI行動原則A1-A4）でBright Lines違反が検出された場合、DT-0に戻る | 状態 | A4 → DT-0 | DT-9ルール6の是正アクション「DT-0に戻る」を確認 |
| **INV-CA3** | AI出力には常に検証方法と自信度が明示される（A3原則） | 存在 | A3 | DT-9ルール3, 4を確認 |

---

## 不変条件の統計

### 構成要素別の不変条件数

| 構成要素 | 不変条件グループ | 個数 | 最低1つの基準 |
|---------|----------------|------|-------------|
| 階層構造 | INV-H | 5 | ✅ |
| メインフロー | INV-MF | 6 | ✅ |
| SP-1（L0-L3チェック） | INV-SP1 | 5 | ✅ |
| SP-2（AIファーストチェック） | INV-SP2 | 4 | ✅ |
| SP-3（検証フィードバックループ） | INV-SP3 | 5 | ✅ |
| LC（損切り判断） | INV-LC | 5 | ✅ |
| RF（復帰フロー） | INV-RF | 6 | ✅ |
| ES（エスカレーション判断） | INV-ES | 3 | ✅ |
| TD（タスク分解） | INV-TD | 4 | ✅ |
| 決定表（DT-0〜DT-10） | INV-DT | 8 | ✅ |
| データオブジェクト | INV-DO | 6 | ✅ |
| フロー間接続 | INV-CF | 5 | ✅ |
| Bright Lines | INV-BL | 4 | ✅ |
| 協働・AI行動原則 | INV-CA | 3 | ✅ |
| **合計** | **14グループ** | **74** | **全基準充足** |

### 分類別の不変条件数

| 分類 | 個数 | 割合 |
|------|------|------|
| 順序不変条件 | 22 | 30% |
| 状態不変条件 | 27 | 36% |
| 存在不変条件 | 12 | 16% |
| 階層不変条件 | 5 | 7% |
| データ不変条件 | 8 | 11% |
| **合計** | **74** | **100%** |

---

## 検証チェックリスト

- [x] 階層構造（L0-L4）に関する不変条件がある（INV-H: 5個）
- [x] メインフロー（§1）に関する不変条件がある（INV-MF: 6個）
- [x] SP-1（L0-L3チェック）に関する不変条件がある（INV-SP1: 5個）
- [x] SP-2（AIファーストチェック）に関する不変条件がある（INV-SP2: 4個）
- [x] SP-3（検証フィードバックループ）に関する不変条件がある（INV-SP3: 5個）
- [x] LC（損切り判断）に関する不変条件がある（INV-LC: 5個）
- [x] RF（復帰フロー）に関する不変条件がある（INV-RF: 6個）
- [x] ES（エスカレーション判断）に関する不変条件がある（INV-ES: 3個）
- [x] TD（タスク分解）に関する不変条件がある（INV-TD: 4個）
- [x] 決定表（DT-0〜DT-10）に関する不変条件がある（INV-DT: 8個）
- [x] データオブジェクト（D-1〜D-8）に関する不変条件がある（INV-DO: 6個）
- [x] フロー間接続に関する不変条件がある（INV-CF: 5個）
- [x] Bright Linesに関する不変条件がある（INV-BL: 4個）
- [x] 協働・AI行動原則に関する不変条件がある（INV-CA: 3個）
- [x] 各不変条件に検証方法が明示されている
- [x] 各不変条件に分類（順序/状態/存在/階層/データ）が付与されている
- [x] 各構成要素に最低1つの不変条件がある

---

## 出典

- `phase1-t1-decision-conditions.md` — L0-L4判断条件、Bright Lines、協働原則、AI行動原則
- `phase1-t2-dmn-decision-tables.md` — DT-0〜DT-10（決定表のルール構造、ヒットポリシー）
- `phase1-t3-bpmn-elements.md` — メインフロー、SP-1〜SP-3、TD、データオブジェクト、フロー接続関係
- `phase1-t4-mermaid-flowcharts.md` — メインフロー系Mermaid図（フロー構造の視覚的確認）
- `phase1-t5-losscutrecovery-bpmn.md` — LC、RF、ES、T3との接続マップ
- `phase1-t6-losscut-recovery-mermaid.md` — 損切り＋復帰系Mermaid図（フロー構造の視覚的確認）
- プロジェクトナレッジ `00e-haste-simplicity.md` — 契約による設計（DbC）における不変条件の定義

---

## スコープ外の提案（参考情報）

以下はT7のスコープ外だが、フェーズ1完了後の検討事項として記録：

1. **不変条件の形式検証**: 本リストのMarkdown記述を、TLA+やAlloy等の形式仕様言語に変換し、機械的に検証可能にする
2. **不変条件のテストケース化**: 各不変条件から「違反ケース」と「正常ケース」のペアを生成し、フレームワーク適用のテストシナリオとして活用する
3. **実行時チェックの自動化**: CLAUDE.mdや開発ツールに不変条件チェックを組み込み、フレームワーク適用時にリアルタイムで不変条件違反を検出する仕組みを構築する
4. **不変条件間の依存関係分析**: 不変条件同士の依存関係（例: INV-RF2はINV-DO1を前提とする）を整理し、不変条件の完全性と無矛盾性を検証する
